CREATE TABLE board (
    id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name TEXT NOT NULL UNIQUE,
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

CREATE TABLE channel (
    id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name TEXT NOT NULL,
    board_id BIGINT NOT NULL REFERENCES board (id) ON DELETE CASCADE ON UPDATE CASCADE,
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    UNIQUE (board_id, name)
);

CREATE TABLE message (
    id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    channel_id BIGINT NOT NULL REFERENCES channel (id) ON DELETE NO ACTION ON UPDATE CASCADE,
    user_id BIGINT NOT NULL REFERENCES app_user (id) ON DELETE NO ACTION ON UPDATE CASCADE,
    content TEXT NOT NULL,
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

CREATE TRIGGER update_board_updated_at_column BEFORE UPDATE ON board FOR EACH ROW EXECUTE PROCEDURE update_updated_at_column();

CREATE TRIGGER update_channel_updated_at_column BEFORE UPDATE ON channel FOR EACH ROW EXECUTE PROCEDURE update_updated_at_column();

CREATE TRIGGER update_message_at_column BEFORE UPDATE ON message FOR EACH ROW EXECUTE PROCEDURE update_updated_at_column();
